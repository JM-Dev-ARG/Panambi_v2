---
import logo from "@/assets/svg/logotipoPanambi.svg";
import LogotipoAnimado from "../svg/LogotipoAnimado.astro";
import { swapBodyElement } from "astro/virtual-modules/transitions-swap-functions.js";
import Carrousel from "../Carrousel.astro";
---

<nav
  class="top-0 z-50 mx-auto hidden w-full place-items-center gap-3 pt-3 md:sticky lg:grid"
>
  <div
    class="bg-negro/85 backdrop-blur-xs tracking-panambi-nav flex h-[75px] w-[30%] min-w-[570px] items-center justify-between rounded-xl p-[6px] text-[14px] font-normal text-neutral-100"
  >
    <a
      href="/"
      class="size-[67px]"
      ><LogotipoAnimado />
    </a>
    <div class="flex h-full flex-1 items-center justify-evenly">
      <div
        class="flex h-full items-center justify-center transition-all duration-300"
      >
        <a
          class="transform-3d nav-link group flex h-full cursor-pointer items-center justify-center pt-5"
          href="/servicios"
          data-target="servicios"
        >
          <div class="h-full overflow-hidden">
            <p
              class="transform-3d h-full pt-[2px] transition-all duration-500 group-hover:-translate-y-full group-hover:opacity-0"
            >
              Servicios
            </p>
            <p
              class="transform-3d h-full pt-[2px] opacity-0 transition-all duration-500 group-hover:-translate-y-full group-hover:opacity-100"
            >
              Servicios
            </p>
          </div>
        </a>
      </div>
      <div
        class="flex h-full items-center justify-center transition-all duration-300"
      >
        <a
          class="transform-3d nav-link group flex h-full cursor-pointer items-center justify-center pt-5"
          href="/proyectos"
          data-target="proyectos"
        >
          <div class="h-full overflow-hidden">
            <p
              class="transform-3d h-full pt-[2px] transition-all duration-500 group-hover:-translate-y-full group-hover:opacity-0"
            >
              Proyectos
            </p>
            <p
              class="transform-3d h-full pt-[2px] opacity-0 transition-all duration-500 group-hover:-translate-y-full group-hover:opacity-100"
            >
              Proyectos
            </p>
          </div>
        </a>
      </div>

      <div
        class="flex h-full items-center justify-center transition-all duration-300"
      >
        <a
          class="transform-3d nav-link group flex h-full cursor-pointer items-center justify-center pt-5"
          href="/equipo"
          data-target="equipo"
        >
          <div class="h-full overflow-hidden">
            <p
              class="transform-3d h-full pt-[2px] transition-all duration-500 group-hover:-translate-y-full group-hover:opacity-0"
            >
              Equipo
            </p>
            <p
              class="transform-3d h-full pt-[2px] opacity-0 transition-all duration-500 group-hover:-translate-y-full group-hover:opacity-100"
            >
              Equipo
            </p>
          </div>
        </a>
      </div>
    </div>
    <div class="flex h-full items-center justify-center">
      <a
        class="transform-3d group flex h-full cursor-pointer items-center justify-center rounded-lg bg-neutral-50 px-7 pt-5 font-semibold text-neutral-900 transition-all duration-500 hover:scale-[98%]"
        href="/contacto"
      >
        <div class="h-full overflow-hidden">
          <p
            class="transform-3d h-full pt-[2px] transition-all duration-500 group-hover:-translate-y-full group-hover:opacity-0"
          >
            Contacto
          </p>
          <p
            class="transform-3d h-full pt-[2px] opacity-0 transition-all duration-500 group-hover:-translate-y-full group-hover:opacity-100"
          >
            Contacto
          </p>
        </div>
      </a>
    </div>
  </div>
  <div
    class="bg-negro backdrop-blur-xs navbar__content flex h-[200px] w-[30%] min-w-[570px] scale-0 items-center justify-between overflow-hidden rounded-xl opacity-0 transition-all duration-500 p-1"
  >
    <!-- Contenido para servicios -->
    <div
      id="servicios-content"
      class="hidden h-full w-full items-center justify-center"
    >
      <p class="text-2xl font-bold text-white">Nuestros Servicios</p>
    </div>


    <!-- Contenido con carrousel -->
    <div id="carrousel_container" class="w-full h-full flex items-center justify-center rounded-lg overflow-hidden">
      <Carrousel
      className="h-full  "
      classSlider="h-full gap-2 "
      id="nav-carrousel"
      duration="fast"
      >
      </Carrousel>
    </div>
    
  </div>

  <script>
    import dataEquipo from "../../../Data/navbar_equipo.json";
    import dataProyectos from "../../../Data/navbar_proyectos.json";
    import dataServicios from "../../../Data/navbar_servicios.json";

    document.addEventListener("astro:page-load", () => {
      const navLinks = document.querySelectorAll(
        ".nav-link"
      ) as NodeListOf<HTMLAnchorElement>;
      const navContent = document.querySelector(
        ".navbar__content"
      ) as HTMLDivElement;
      const carrouselContainer = document.getElementById(
        "carrousel_container"
      ) as HTMLDivElement;
      const carrousel = document.getElementById(
        "nav-carrousel"
      ) as HTMLDivElement;
      const serviciosContent = document.getElementById(
        "servicios-content"
      ) as HTMLDivElement;

      const navData = {
        servicios: dataServicios,
        proyectos: dataProyectos,
        equipo: dataEquipo,
      };

      let leaveTimeout: NodeJS.Timeout;

      const showNavContent = (target: keyof typeof navData) => {
        clearTimeout(leaveTimeout);

        if (target === "servicios") {
          if (carrousel) carrouselContainer.style.display = "none";
          if (serviciosContent) {
            serviciosContent.style.display = "flex";
            
          }
        } else  {
          if (serviciosContent) serviciosContent.style.display = "none";
          if (carrousel) {
            carrouselContainer.style.display = "block";
            const data = navData[target] || [];
            let carouselItemsHTML = "";
            data.forEach((item) => {
              carouselItemsHTML += `<div class="flex h-full w-[180px] flex-col items-center justify-center rounded-md text-center">
                <img src="${item.img}" alt="${item.title}" class="h-full rounded-xl object-cover" />
              </div>`;
            });
            carrousel.innerHTML = carouselItemsHTML;
          }
        }
        navContent?.classList.add("scale-100", "opacity-100");
      };

      const hideNavContent = () => {
        leaveTimeout = setTimeout(() => {
          navContent?.classList.remove("scale-100", "opacity-100");
        }, 200);
      };

      navLinks.forEach((link) => {
        link.addEventListener("mouseenter", () => {
          const target = link.dataset.target;
          if (target) {
            showNavContent(target as keyof typeof navData);
          }
        });
        link.addEventListener("mouseleave", hideNavContent);
      });

      navContent?.addEventListener("mouseenter", () => {
        clearTimeout(leaveTimeout);
      });

      navContent?.addEventListener("mouseleave", hideNavContent);
    });
  </script>
</nav>
