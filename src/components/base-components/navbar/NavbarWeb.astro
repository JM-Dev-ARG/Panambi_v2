---
import LogotipoAnimado from "../svg/LogotipoAnimado.astro";
import Carrousel from "../Carrousel.astro";
import dataLinks from "@/data/link_navbar_web.json";
import linksServicios from "@/data/link_servicios_navbar.json";
import LinkNavBarWeb from "./LinkNavBarWeb.astro";

const currentPage = Astro.url.pathname.split("/")[1];
---

<nav
  class="top-0 z-50 mx-auto hidden w-full place-items-center gap-3 pt-2 md:fixed lg:grid"
>
  <div
    class="bg-negro/85 backdrop-blur-xs tracking-panambi-nav flex h-[55px] w-[30%] min-w-[470px] items-center justify-between rounded-xl p-[6px] text-[12px] font-normal text-neutral-100 2xl:h-[75px] 2xl:text-[14px]"
  >
    <a href="/" title="Link a pagina Index" class="size-[48px] 2xl:size-[67px]"
      ><LogotipoAnimado />
    </a>
    <div class="flex h-full flex-1 items-center justify-evenly">
      {
        dataLinks.map((link) => (
          <LinkNavBarWeb
            currentPage={currentPage}
            href={link.href}
            label={link.label}
          />
        ))
      }
    </div>
    <div class="flex h-full items-center justify-center">
      <a
        class="transform-3d group relative flex h-full cursor-pointer flex-col items-center justify-center rounded-lg bg-neutral-50 px-3 font-semibold text-neutral-900 transition-all duration-500 hover:scale-[98%] 2xl:px-4"
        href="/contacto"
        title="Link a sección Contacto"
      >
        <p
          class="abasolute transform-3d -top-1/2 left-0 translate-y-1/2 transition-all duration-500 group-hover:-translate-y-full group-hover:opacity-0"
        >
          Contacto
        </p>
        <p
          class="abasolute transform-3d -top-full left-0 opacity-0 transition-all duration-500 group-hover:-translate-y-1/2 group-hover:opacity-100"
        >
          Contacto
        </p>
      </a>
    </div>
  </div>

  <!-- Contenedor deslizante -->
  <div
    id="contenedor_deslizante"
    class="backdrop-blur-xs navbar__content bg-negro z-50 flex h-[0px] w-[30%] min-w-[470px] scale-0 items-center justify-center overflow-hidden rounded-xl p-1 opacity-0 transition-all duration-500"
  >
    <!-- Contenido para servicios -->
    <div id="servicios-content" class="h-full w-full">
      <div
        class="transform-3d font-titulo flex h-full w-full flex-col items-center justify-center text-2xl font-semibold text-neutral-100"
      >
        {
          linksServicios.map((link) => (
            <a
              class="transform-3d group relative flex cursor-pointer flex-col items-center justify-center overflow-hidden"
              href={`/${link.href}`}
              title={`Link a sección ${link.label}`}
            >
              <p class="abasolute transform-3d -top-1/2 left-0 translate-y-1/2 transition-all duration-500 group-hover:-translate-y-full group-hover:opacity-0">
                {link.label}
              </p>
              <p class="abasolute transform-3d -top-full left-0 opacity-0 transition-all duration-500 group-hover:-translate-y-1/2 group-hover:opacity-100">
                {link.label}
              </p>
            </a>
          ))
        }
      </div>
    </div>

    <!-- Contenido con carrousel -->
    <div
      id="carrousel_container"
      class="flex h-full w-full items-center justify-center overflow-hidden rounded-lg"
    >
      <Carrousel
        className="h-full"
        classSlider="h-full gap-2 "
        id="nav-carrousel"
        duration="fast"
      />
    </div>
  </div>
</nav>

<script>
  import dataEquipo from "../../../data/equipo.json";
  import dataProyectos from "../../../data/data_proyectos.json";
  import dataServicios from "../../../data/navbar_servicios.json";

  document.addEventListener("astro:page-load", () => {
    const navLinks = document.querySelectorAll(
      ".nav-link",
    ) as NodeListOf<HTMLAnchorElement>;
    const navContent = document.querySelector(
      ".navbar__content",
    ) as HTMLDivElement;
    const carrouselContainer = document.getElementById(
      "carrousel_container",
    ) as HTMLDivElement;
    const carrousel = document.getElementById(
      "nav-carrousel",
    ) as HTMLDivElement;
    const serviciosContent = document.getElementById(
      "servicios-content",
    ) as HTMLDivElement;

    const navData = {
      servicios: dataServicios,
      proyectos: dataProyectos,
      equipo: dataEquipo,
    };

    let leaveTimeout: NodeJS.Timeout;

    const currentPage = window.location.pathname.split("/")[1];
    console.log(currentPage);

    const showNavContent = (target: keyof typeof navData) => {
      clearTimeout(leaveTimeout);

      if (target === currentPage) {
        return;
      }

      if (target === "servicios") {
        if (carrousel) {
          navContent.classList.remove("bg-negro");
          navContent.classList.add("bg-negro/85");
        }
        carrouselContainer.style.display = "none";
        if (serviciosContent) {
          serviciosContent.style.display = "flex";
          navContent.classList.add("mascara");
        }
      } else {
        if (serviciosContent) serviciosContent.style.display = "none";
        if (carrousel) {
          navContent.classList.remove("bg-negro/85");
          navContent.classList.add("bg-negro");
          carrouselContainer.style.display = "block";
          navContent.classList.remove("mascara");
          const data = navData[target] || [];
          let carouselItemsHTML = "";
          data.forEach((item) => {
            carouselItemsHTML += `<div class="flex h-full w-[180px] flex-col items-center justify-center text-center ">
                <img src="${item.img}" alt="${item.titulo}" title="${item.titulo}" loading="lazy" height="auto" width="auto" class="h-full  object-cover rounded-xl" />
              </div>`;
          });
          carrousel.innerHTML = carouselItemsHTML;
        }
      }
      navContent?.classList.add("scale-100", "opacity-100", "h-[200px]");
      navContent?.classList.remove("h-[0px]");
    };

    const hideNavContent = () => {
      leaveTimeout = setTimeout(() => {
        navContent?.classList.remove("scale-100", "opacity-100", "h-[200px]");
        navContent?.classList.add("h-[0px]");
      }, 200);
    };

    navLinks.forEach((link) => {
      link.addEventListener("mouseenter", () => {
        const target = link.dataset.target;
        if (target === currentPage) {
          return;
        }

        if (target) {
          showNavContent(target as keyof typeof navData);
        }
      });
      link.addEventListener("mouseleave", hideNavContent);
    });

    navContent?.addEventListener("mouseenter", () => {
      clearTimeout(leaveTimeout);
    });

    navContent?.addEventListener("mouseleave", hideNavContent);
  });
</script>
