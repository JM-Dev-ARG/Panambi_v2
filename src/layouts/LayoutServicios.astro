---
import { ClientRouter } from "astro:transitions";
import "../styles/global.css";

import icono_metadata from "@/assets/svg/logotipo.svg";
import favicon from "@/assets/svg/logotipo.svg";
import dataSchema from "@/data/seoSchema.json";
import Footer from "@/components/base-components/Footer.astro";
import NavbarServicios from "@/components/base-components/navbar/NavbarServicios.astro";
import NavBarServiciosMovil from "@/components/base-components/navbar/NavBarServiciosMovil.astro";

interface Props {
  title: string;
  description: string;
  dataLinks: { href: string; label: string }[]; // Links internos de navegación de la página
  keywords?: string[];
  ogImage?: string;
  serviceType?: string;
}
const { title, description, dataLinks, keywords, ogImage, serviceType } =
  Astro.props;

// URL canónica dinámica
const canonicalURL = new URL(Astro.url.pathname, Astro.site).toString();

// Imagen OG dinámica o por defecto
const ogImageURL = ogImage
  ? new URL(ogImage, Astro.site).toString()
  : new URL(icono_metadata.src, Astro.site).toString();

// Catálogo de servicios (fijo para el schema)
const serviceCatalog = [
  { href: "/servicios/asesoriaOneShot", label: "Asesoría One Shot" },
  { href: "/servicios/desarrollo_web", label: "Desarrollo Web" },
  { href: "/servicios/diseno_audiovisual", label: "Diseño Audiovisual" },
  { href: "/servicios/consultoria", label: "Consultoría Personalizada" },
];

// Schema optimizado para servicios
const schema = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "ProfessionalService",
      "@id": `${Astro.site}#organization`,
      name: "Panambi",
      description:
        "Estrategia digital, desarrollo web y contenido visual para profesionales y empresas",
      email: "info@panambi.net",
      url: Astro.site?.toString(),
      logo: {
        "@type": "ImageObject",
        url: dataSchema.logo,
      },
      contactPoint: {
        "@type": "ContactPoint",
        telephone: dataSchema.contactPoint.telephone,
        contactType: "Atención al cliente",
        areaServed: dataSchema.contactPoint.areaServed,
        availableLanguage: dataSchema.contactPoint.availableLanguage,
      },
      sameAs: dataSchema.sameAs,
      address: {
        "@type": "PostalAddress",
        streetAddress: dataSchema.address.streetAddress,
        addressLocality: dataSchema.address.addressLocality,
        addressRegion: dataSchema.address.addressRegion,
        postalCode: dataSchema.address.postalCode,
        addressCountry: dataSchema.address.addressCountry,
      },
      hasOfferCatalog: {
        "@type": "OfferCatalog",
        name: "Servicios Panambi",
        itemListElement: serviceCatalog.map((service, index) => ({
          "@type": "Offer",
          itemOffered: {
            "@type": "Service",
            name: service.label,
            url: new URL(service.href, Astro.site).toString(),
          },
          position: index + 1,
        })),
      },
    },
    {
      "@type": serviceType || "WebPage",
      "@id": canonicalURL,
      url: canonicalURL,
      name: title,
      description: description,
      isPartOf: {
        "@id": `${Astro.site}#website`,
      },
      about: {
        "@id": `${Astro.site}#organization`,
      },
      inLanguage: "es-AR",
      breadcrumb: {
        "@type": "BreadcrumbList",
        itemListElement: [
          {
            "@type": "ListItem",
            position: 1,
            name: "Inicio",
            item: Astro.site?.toString(),
          },
          {
            "@type": "ListItem",
            position: 2,
            name: "Servicios",
            item: `${Astro.site}servicios`,
          },
          {
            "@type": "ListItem",
            position: 3,
            name: title.split("|")[0].trim(),
            item: canonicalURL,
          },
        ],
      },
    },
  ],
};
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />

    <title>{title}</title>
    <meta name="description" content={description} />

    <link rel="canonical" href={canonicalURL} />

    {
      keywords && keywords.length > 0 && (
        <meta name="keywords" content={keywords.join(", ")} />
      )
    }

    <meta name="robots" content="index, follow" />
    <meta name="author" content="Panambi" />

    <link rel="icon" type="image/svg+xml" href={favicon.src} />
    <link rel="apple-touch-icon" href={favicon.src} />

    <ClientRouter />

    <script type="application/ld+json" set:html={JSON.stringify(schema)} />

    <meta property="og:url" content={canonicalURL} />
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImageURL} />
    <meta property="og:locale" content="es_AR" />
    <meta property="og:site_name" content="Panambi" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImageURL} />
  </head>
  <body>
    <NavbarServicios dataLinks={dataLinks} />
    <NavBarServiciosMovil dataLinks={dataLinks} />

    <slot />
    <Footer />
  </body>
</html>

<style>
  :root {
    interpolate-size: allow-keywords;
    scroll-behavior: smooth;
    transition-behavior: allow-discrete;
  }
  body {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    background-color: #f9f9f9;
    font-family: var(--font-base);
  }
</style>

<script>
  import AOS from "aos";
  import "aos/dist/aos.css";
  document.addEventListener("astro:page-load", () => {
    AOS.init({
      once: true,
      duration: 800,
    });
  });
</script>
